(function(){"use strict";const r=o=>{const e=document.cookie.split("; ");for(const t of e){const[n,c]=t.split("=");if(n===o)return JSON.parse(c)}return null},m=()=>{var o;return(o=window==null?void 0:window["cua-chat"])==null?void 0:o.chatHost},C=()=>m()==="powerhub",p="en_US",g="zh_CN",l="US",f="CN",y="NL",d="tesla.cn",E=(()=>{if(window.location.hostname.includes(d))return g;const e=window.location.pathname,t=/\/([a-zA-Z]{2})_([a-zA-Z]{2})/,n=e.match(t);return n?`${n[1]}_${n[2].toLocaleUpperCase()}`:p})(),L=(()=>{if(window.location.hostname.includes(d))return f;const e=window.location.pathname,t=/\/([a-zA-Z]{2})_([a-zA-Z]{2})/,n=e.match(t);return n?n[2].toLocaleUpperCase():l})(),_=async()=>{var c,s,a,u,w;const o=r("preferred_address");if((c=o==null?void 0:o.region)!=null&&c.regionCode)return o.region.regionCode;const e=r("device_location");if((s=e==null?void 0:e.region)!=null&&s.regionCode)return e.region.regionCode;const t=r("ip_info");if((a=t==null?void 0:t.region)!=null&&a.regionCode)return t==null?void 0:t.region.regionCode;const n=await b();return((w=(u=n==null?void 0:n.subdivisions)==null?void 0:u[0])==null?void 0:w.iso_code)||""},b=async()=>await fetch("https://location-services-prd.tesla.com/geoip/city").then(o=>o.json()),v=(()=>{var o,e;return(o=window==null?void 0:window["cua-chat"])!=null&&o.baseUrl?(e=window["cua-chat"])==null?void 0:e.baseUrl:""})(),h=async()=>{const o=await _();if(C()){i();return}fetch(`/data/get-chat-init-configs.json?locale=${E}&stateProvince=${o}&pageUrl=${encodeURIComponent(window.location.href)}`).then(e=>e.json()).then(e=>{const t=e.LDChatConfigurations,n=t.isChatLite||t.triage||t.chatOnBasic;if(!t.isMobile&&window.screen.width<=599)return;if(new URLSearchParams(window.location.search).get("forceBRChat")==="true"&&([y,l].includes(L)||window.location.origin==="https://stage.tesla.com")){i();return}t.teslaAssistFlag||t.teslaAssistBREnabled?i():n&&A()}).catch(()=>{throw new Error("[Chat Loader] Error getting chat configs ")})},A=()=>{const o=document.createElement("script");o.src="/cua/assets/apps/oceana/chat-ui.js",o.async=!0;const e=document.createElement("link");e.href="/cua/assets/apps/oceana/chat-ui.css",e.rel="stylesheet",document.body.appendChild(o),document.body.appendChild(e);let t=0;const n=500,c=10,s=setInterval(()=>{var a;t++,(a=window==null?void 0:window.avaya)!=null&&a.init_chat?(window.avaya.init_chat(),clearInterval(s)):t>=c&&clearInterval(s)},n)},i=()=>{const e=`https://cua-chat-ui${["https://www.tesla.com","https://powerhub.energy.tesla.com"].includes(window.location.origin)?"":"-stage"}.tesla.com`;fetch(`${e}/.vite/manifest.json?v=${Date.now()}`).then(t=>{if(!t.ok)throw new Error("[Chat Loader] error fetching manifest.json");return t.json()}).then(t=>{if(t["index.html"]){const n=document.createElement("script");n.src=`${e}/${t["index.html"].file}`,n.type="module",n.async=!0;const c=document.createElement("link");c.href=`${e}/${t["index.html"].css[0]}`,c.rel="stylesheet",document.body.appendChild(n),document.body.appendChild(c)}}).catch(()=>{throw new Error("[Chat Loader] error fetching manifest.json")})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",h):h()})();
